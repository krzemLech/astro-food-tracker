---
import type { WeightInput } from "@/types/weight";
import WeightForm from "./WeightForm.svelte";
import { db, Weights, eq } from "astro:db";
import Card from "@/components/ui/Card.astro";
let weight = null;
let weights: WeightInput[] = [];
const editing = Astro.url.searchParams.get("edit");
const weightParams = Astro.url.searchParams.get("weight");
const [resource, id] = editing?.split(",") || [];
if (resource === "weight" && id) {
  weights = await db
    .select()
    .from(Weights)
    .where(eq(Weights.id, parseInt(id)));
}
if (weights.length > 0) {
  weight = weights[0];
  // @ts-ignore
  if (weight.createdAt) delete weight.createdAt;
}
---

<Card
  className={`mt-4 bg-green-900/20 ${editing || weightParams ? "block" : "hidden"}`}
>
  <WeightForm client:load weight={weight} />
</Card>
